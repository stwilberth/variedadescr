DirectoryIndex index.php index.html index.htm

# Habilitar el motor de reescritura una sola vez
RewriteEngine On

# Forzar HTTPS primero (debe ir antes de otras reglas)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Forzar www
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Protección básica de seguridad
ServerSignature Off
Options -Indexes
Options -MultiViews

# Configuración de seguridad
<IfModule mod_headers.c>
    # Cabeceras de seguridad esenciales
    Header always set X-Frame-Options "SAMEORIGIN"
    Header set X-Content-Type-Options "nosniff"
    Header set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Política de seguridad de contenido más estricta
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'"
    
    # Ocultar información del servidor
    Header unset Server
    Header unset X-Powered-By
    Header always unset X-Powered-By
    
    # Permitir indexación solo si es necesario
    Header unset X-Robots-Tag
</IfModule>

# Protección contra métodos HTTP peligrosos
<LimitExcept GET POST HEAD>
    deny from all
</LimitExcept>

# Protección de archivos sensibles
<FilesMatch "^(\.|wp-config\.php|php\.ini|config\.php|\.htaccess|\.env|\.git)">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protección contra scripts maliciosos
<FilesMatch "\.(ph(p[3457]?|t|tml)|aspx?|dll|exe|msi|cgi|pl|asp)$">
    Order deny,allow
    Deny from all
</FilesMatch>

# Compresión de contenido
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css text/javascript application/xml application/xhtml+xml application/javascript application/x-javascript application/json
</IfModule>

# Protección anti-hotlinking de imágenes
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^https?://(www\.)?(variedadescr\.com|aprendemusica\.net|wilberth\.com|ecoexpeditionscr\.com|sublimadosloria\.com|tiendajala\.com|tumelatex\.com)(/.*)?$ [NC]
RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [F,NC]

# Redirigir todo el tráfico a public/
RewriteCond %{REQUEST_URI} !/public
RewriteRule ^(.*)$ public/$1 [L]

# php -- BEGIN cPanel-generated php ini directives, do not edit
# Manual editing of this file may result in unexpected behavior.
# To make changes to this file, use the cPanel MultiPHP INI Editor (Home >> Software >> MultiPHP INI Editor)
# For more information, read our documentation (https://go.cpanel.net/EA4ModifyINI)
<IfModule php8_module>
   php_flag display_errors On
   php_value max_execution_time 30
   php_value max_input_time 60
   php_value max_input_vars 1000
   php_value memory_limit 256M
   php_value post_max_size 516M
   php_value session.gc_maxlifetime 1440
   php_value session.save_path "/var/cpanel/php/sessions/ea-php82"
   php_value upload_max_filesize 512M
   php_flag zlib.output_compression Off
</IfModule>
<IfModule lsapi_module>
   php_flag display_errors On
   php_value max_execution_time 30
   php_value max_input_time 60
   php_value max_input_vars 1000
   php_value memory_limit 256M
   php_value post_max_size 516M
   php_value session.gc_maxlifetime 1440
   php_value session.save_path "/var/cpanel/php/sessions/ea-php82"
   php_value upload_max_filesize 512M
   php_flag zlib.output_compression Off
</IfModule>
# END cPanel-generated php ini directives, do not edit

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “ea-php82” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php82___lsphp .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
